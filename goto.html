<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abhishek QuizMaster: PDF to MCQs</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);
            color: #fff; 
            margin: 0; 
            padding: 40px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container { 
            max-width: 1000px; 
            background: rgba(255, 255, 255, 0.95); 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 40px;
            color: #333;
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 { 
            color: #ff6b6b; 
            text-align: center; 
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .subtitle {
            text-align: center;
            color: #555;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        input[type="file"] { 
            display: block; 
            margin: 20px auto; 
            padding: 15px; 
            border: 3px dashed #4ecdc4; 
            border-radius: 15px; 
            background: #f0f8ff; 
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            color: #4ecdc4;
            transition: all 0.3s;
        }
        input[type="file"]:hover { 
            background: #e0f0ff; 
            border-color: #ff6b6b;
            transform: scale(1.05);
        }
        #textDisplay { 
            margin: 30px 0; 
            padding: 20px; 
            background: #f8f9fa; 
            border-radius: 15px; 
            max-height: 250px; 
            overflow-y: auto; 
            display: none;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }
        #mcq-section { display: none; }
        .question { 
            background: linear-gradient(135deg, #ffffff, #f0f8ff); 
            margin: 25px 0; 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
            border-left: 8px solid #4ecdc4;
            transition: transform 0.3s;
        }
        .question:hover { transform: translateY(-5px); }
        .question h3 { color: #333; font-size: 1.4em; }
        .options { list-style: none; padding: 0; }
        .option { 
            background: #e8f4f8; 
            margin: 15px 0; 
            padding: 18px; 
            border-radius: 12px; 
            cursor: pointer; 
            transition: all 0.3s; 
            border: 2px solid #bdc3c7;
            font-weight: 500;
        }
        .option:hover { 
            background: #d0eaff; 
            border-color: #4ecdc4;
            transform: translateX(8px);
        }
        .option.selected { background: #a8d4ff; border-color: #ff6b6b; }
        .option.correct { background: #28a745; color: white; border-color: #1e7e34; }
        .option.incorrect { background: #dc3545; color: white; border-color: #bd2130; }
        .answer { 
            display: none; 
            background: linear-gradient(135deg, #28a745, #20c997); 
            color: white; 
            padding: 18px; 
            border-radius: 12px; 
            margin-top: 20px; 
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        button { 
            background: linear-gradient(135deg, #4ecdc4, #ff6b6b); 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            border-radius: 12px; 
            cursor: pointer; 
            margin: 10px 5px; 
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }
        button:hover { 
            transform: scale(1.08); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .progress { 
            width: 100%; 
            height: 15px; 
            background: #e9ecef; 
            border-radius: 8px; 
            margin: 25px 0;
            overflow: hidden;
        }
        .progress-bar { 
            height: 100%; 
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4); 
            width: 0%; 
            transition: width 0.4s ease-in-out;
        }
        #loading { 
            display: none; 
            text-align: center; 
            font-size: 1.2em; 
            color: #4ecdc4;
            margin: 20px 0;
        }
        #loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #4ecdc4;
            border-top: 3px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .score-display {
            text-align: center;
            font-size: 1.5em;
            color: #28a745;
            margin-top: 20px;
            display: none;
        }
        .auto-next {
            font-size: 0.9em;
            color: #666;
            text-align: right;
            margin-top: 10px;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #333;
        }
        .footer h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }
        .contact-icon {
            font-size: 3em;
            color: #ea4335;
            text-decoration: none;
            margin: 0 10px;
            transition: transform 0.3s;
        }
        .contact-icon:hover {
            transform: scale(1.2);
            color: #c5221f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Abhishek QuizMaster: PDF to MCQs</h1>
        <p class="subtitle">Upload your PDF, answer MCQs, and auto-advance to the next question! Fast & Fun Learning!</p>
        <input type="file" id="pdfUpload" accept=".pdf">
        
        <div id="loading">Processing your PDF... Please wait.</div>
        
        <div id="textDisplay">
            <h3>Extracted Text Preview:</h3>
            <p id="previewText"></p>
        </div>
        
        <div id="mcq-section">
            <h2 style="color: #333; text-align: center;">Dive into Your MCQ Practice Session</h2>
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div id="questions"></div>
            <div class="score-display" id="scoreDisplay">Your Score: <span id="scoreValue">0</span> / <span id="totalQuestions">0</span></div>
            <button onclick="resetQuiz()" style="display: block; margin: 20px auto;" id="resetBtn">üîÑ Restart Quiz</button>
        </div>

        <div class="footer">
            <h3>Generated by Abhishek QuizMaster</h3>
            <p>Founded by</p>
            <p style="font-size: 1.5em; font-weight: bold; color: #ff6b6b;">Abhishek Kumar</p>
            <a href="mailto:alphaabhishek7201@gmail.com" class="contact-icon" title="Contact via Gmail">‚úâ</a>
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const upload = document.getElementById('pdfUpload');
        const loading = document.getElementById('loading');
        let currentQuiz = [];
        let currentQuestionIndex = 0;
        let score = 0;

        upload.addEventListener('change', handleUpload);

        async function handleUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            loading.style.display = 'block';
            const arrayBuffer = await file.arrayBuffer();
            const loadingTask = pdfjsLib.getDocument(arrayBuffer);
            const pdf = await loadingTask.promise;

            let fullText = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += pageText + '\n';
            }

            document.getElementById('previewText').textContent = fullText.substring(0, 800) + '...';
            document.getElementById('textDisplay').style.display = 'block';

            currentQuiz = generateMCQs(fullText);
            displayMCQs();
            document.getElementById('mcq-section').style.display = 'block';
            document.getElementById('resetBtn').style.display = 'block';
            loading.style.display = 'none';
        }

        function generateMCQs(text) {
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 20).map(s => s.trim()); // Lowered threshold for more sentences
            const mcqs = [];
            const maxQuestions = 500; // Target up to 500

            for (let i = 0; i < sentences.length && mcqs.length < maxQuestions; i++) {
                // Generate a question from every sentence
                const questionText = sentences[i].substring(0, 200) + (sentences[i].length > 200 ? '...' : '');
                // Correct answer is a key fact from the sentence or next one if available
                let correctAnswer = questionText.substring(0, 150) + (questionText.length > 150 ? '...' : '');
                
                // Generate diverse distractors
                const words = correctAnswer.split(' ');
                const shuffled = [...words].sort(() => Math.random() - 0.5).join(' ').substring(0, 150);
                const replaced = correctAnswer.replace(/is/g, 'was').replace(/the/g, 'a').replace(/and/g, 'or').replace(/to/g, 'from');
                const distractor1 = sentences[(i + 1) % sentences.length]?.substring(0, 150) || 'A different concept.';
                const distractor2 = 'An unrelated or incorrect statement.';
                const distractor3 = replaced.split(' ').reverse().join(' ').substring(0, 150);

                const distractors = [shuffled, replaced, distractor1, distractor2, distractor3].slice(0, 3);

                const options = [correctAnswer, ...distractors];
                // Shuffle options
                for (let j = options.length - 1; j > 0; j--) {
                    const k = Math.floor(Math.random() * (j + 1));
                    [options[j], options[k]] = [options[k], options[j]];
                }
                const correctIndex = options.indexOf(correctAnswer);

                // Vary question types occasionally
                let question = questionText;
                if (i % 5 === 0) {
                    question = `What is the key point in: "${questionText}"?`;
                } else if (i % 7 === 0) {
                    question = `According to the content: ${questionText}`;
                }

                mcqs.push({
                    question,
                    options,
                    correctIndex,
                    userAnswer: null
                });
            }

            // If less than 100, add some generic ones based on text themes, but prioritize real content
            while (mcqs.length < 100 && mcqs.length < maxQuestions) {
                mcqs.push({
                    question: `General query from PDF: What is a main idea?`,
                    options: ['Correct fact from text', 'Distractor 1', 'Distractor 2', 'Distractor 3'],
                    correctIndex: Math.floor(Math.random() * 4),
                    userAnswer: null
                });
            }

            console.log(`Generated ${mcqs.length} MCQs`); // For debugging
            return mcqs.slice(0, maxQuestions);
        }

        function displayMCQs() {
            const questionsDiv = document.getElementById('questions');
            questionsDiv.innerHTML = '';
            currentQuestionIndex = 0;
            score = 0;
            updateScoreDisplay();

            currentQuiz.forEach((mcq, index) => {
                const qDiv = document.createElement('div');
                qDiv.className = 'question';
                qDiv.id = `q-${index}`;
                qDiv.style.display = index === 0 ? 'block' : 'none';
                qDiv.innerHTML = `
                    <h3>Question ${index + 1} of ${currentQuiz.length}:</h3>
                    <p><strong>${mcq.question}</strong></p>
                    <ul class="options">
                        ${mcq.options.map((opt, optIndex) => 
                            `<li class="option" onclick="selectAndAutoNext(${index}, ${optIndex})">${String.fromCharCode(65 + optIndex)}. ${opt}</li>`
                        ).join('')}
                    </ul>
                    <div class="answer" id="answer-${index}">
                        ‚úÖ Correct: ${String.fromCharCode(65 + mcq.correctIndex)}. ${mcq.options[mcq.correctIndex]}
                    </div>
                    <p class="auto-next">‚Üí Auto-advances after selection</p>
                `;
                questionsDiv.appendChild(qDiv);
            });

            updateProgress();
            document.getElementById('scoreDisplay').style.display = 'block';
            document.getElementById('totalQuestions').textContent = currentQuiz.length;
        }

        function selectAndAutoNext(qIndex, optIndex) {
            const mcq = currentQuiz[qIndex];
            if (mcq.userAnswer !== null) return;

            mcq.userAnswer = optIndex;
            const options = document.querySelectorAll(`#q-${qIndex} .option`);
            options.forEach((opt, i) => {
                opt.classList.remove('selected', 'correct', 'incorrect');
                if (i === optIndex) opt.classList.add('selected');
            });

            const answerDiv = document.getElementById(`answer-${qIndex}`);
            answerDiv.style.display = 'block';
            options.forEach((opt, i) => {
                if (i === mcq.correctIndex) {
                    opt.classList.add('correct');
                } else if (i === optIndex && optIndex !== mcq.correctIndex) {
                    opt.classList.add('incorrect');
                }
            });

            if (optIndex === mcq.correctIndex) {
                score++;
                updateScoreDisplay();
            }

            updateProgress();

            setTimeout(() => {
                if (qIndex < currentQuiz.length - 1) {
                    document.getElementById(`q-${qIndex}`).style.display = 'none';
                    currentQuestionIndex = qIndex + 1;
                    document.getElementById(`q-${currentQuestionIndex}`).style.display = 'block';
                    updateProgress();
                } else {
                    const finalScore = Math.round((score / currentQuiz.length) * 100);
                    setTimeout(() => {
                        alert(`Quiz Complete! Your score: ${score}/${currentQuiz.length} (${finalScore}%) üèÜ`);
                    }, 800);
                }
            }, 1500);
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / currentQuiz.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function updateScoreDisplay() {
            document.getElementById('scoreValue').textContent = score;
        }

        function resetQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            document.getElementById('textDisplay').style.display = 'none';
            document.getElementById('mcq-section').style.display = 'none';
            document.getElementById('scoreDisplay').style.display = 'none';
            document.getElementById('pdfUpload').value = '';
            upload.click();
        }
    </script>
</body>
</html>